// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  role      String   // 'admin' or 'client'
  firstName String
  lastName  String
  phone     String?
  avatar    String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  properties     Property[]
  sentMessages   Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
  photoGalleries PhotoGallery[] @relation("UserPhotoGalleries")
  packages       Package[]

  @@map("users")
}

model Property {
  id          String   @id @default(cuid())
  name        String
  address     String
  city        String
  country     String
  description String?
  bedrooms    Int
  bathrooms   Int
  maxGuests   Int
  amenities   String?   // JSON string
  photos      String?   // JSON array string
  ownerId     String
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  owner        User          @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  bookings     Booking[]
  maintenance  Maintenance[]
  photoGalleries PhotoGallery[]
  messages     Message[]

  @@map("properties")
}

model Booking {
  id         String   @id @default(cuid())
  propertyId String
  guestName  String
  guestEmail String
  guestPhone String?
  checkIn    DateTime
  checkOut   DateTime
  guests     Int
  totalAmount Float
  status     String   @default("pending") // 'pending', 'confirmed', 'cancelled', 'completed'
  notes      String?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@map("bookings")
}

model Maintenance {
  id             String   @id @default(cuid())
  propertyId     String
  type           String   @default("maintenance") // 'cleaning', 'maintenance'
  title          String
  description    String?
  scheduledDate  DateTime
  completedDate  DateTime?
  status         String   @default("scheduled") // 'scheduled', 'in_progress', 'completed', 'cancelled'
  assignedTo     String?
  photos         String?  // JSON array string
  notes          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  property Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@map("maintenance")
}

model PhotoGallery {
  id              String   @id @default(cuid())
  propertyId      String
  title           String
  description     String?
  photos          String   // JSON array string
  uploadedBy      String
  uploadType      String   @default("monthly_update") // 'monthly_update', 'inspection', 'property_photos'
  month           Int?
  year            Int?
  createdAt       DateTime @default(now())

  // Relations
  property  Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  uploader User      @relation("UserPhotoGalleries", fields: [uploadedBy], references: [id])

  @@map("photo_galleries")
}

model Package {
  id              String   @id @default(cuid())
  ownerId         String
  name            String
  type            String   @default("flat_fee") // 'flat_fee', 'percentage_per_booking', 'check_in_only'
  flatFeeAmount   Float?
  percentageRate  Float?
  checkInFee      Float?
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  owner User @relation(fields: [ownerId], references: [id], onDelete: Cascade)

  @@map("packages")
}

model Message {
  id              String   @id @default(cuid())
  senderId        String
  recipientId     String
  subject         String
  content         String
  isRead          Boolean  @default(false)
  messageType     String   @default("general") // 'general', 'maintenance_alert', 'booking_notification'
  relatedPropertyId String?
  createdAt       DateTime @default(now())

  // Relations
  sender          User         @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  recipient       User         @relation("ReceivedMessages", fields: [recipientId], references: [id], onDelete: Cascade)
  relatedProperty Property?    @relation(fields: [relatedPropertyId], references: [id])

  @@map("messages")
}